<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>椿チャットプロトタイプ</title>
<style>
  body { font-family: 'Yu Gothic', 'Meiryo', sans-serif; background: #f5f5f5; margin: 20px; }
  
  /* Flexboxを使って画像とチャットを横に並べる */
  #chatContainer { 
    display: flex; 
    max-width: 800px; /* 全体の幅を広げる */
    margin: 0 auto; 
    background: #fff; 
    box-shadow: 0 4px 8px rgba(0,0,0,0.1); 
    border-radius: 10px;
  }
  
  /* 画像エリアのスタイル */
  #characterArea {
    width: 300px; /* 画像の表示幅 */
    padding: 15px;
    text-align: center;
    border-right: 1px solid #eee;
    display: flex; /* 画像を中央に配置 */
    align-items: center;
    justify-content: center;
  }
  #tsubakiImage {
    width: 100%; /* 親要素の幅に合わせて画像を表示 */
    height: auto;
    transition: opacity 0.3s; /* 画像切り替え時の滑らかなアニメーション */
  }
  
  /* チャットエリアのスタイル */
  #chat { 
    flex-grow: 1; /* 残りのスペースをチャットが使用 */
    height: 400px; 
    overflow-y: auto; 
    padding: 15px; 
    border-bottom: 1px solid #eee;
  }
  
  /* メッセージの基本スタイル */
  .message { 
    padding: 8px 12px; 
    margin: 8px 0; 
    border-radius: 15px; 
    max-width: 80%; 
    clear: both; /* 左右のメッセージが混ざらないように */
  }
  
  /* ユーザーメッセージのスタイル */
  .user { 
    background: #007bff; 
    color: white; 
    margin-left: auto; 
    text-align: right; 
    border-bottom-right-radius: 0; 
  }
  
  /* 椿のメッセージのスタイル */
  .tsubaki { 
    background: #e0f7fa; 
    color: #333; 
    text-align: left; 
    border-bottom-left-radius: 0; 
    position: relative; 
  }
  .tsubaki::before { 
    content: '椿:'; 
    font-weight: bold; 
    margin-right: 5px; 
    color: #007bff; 
  }
  .tsubaki .gesture { 
    display: block; 
    font-size: 0.9em; 
    color: #666; 
    margin-top: 5px; 
    font-style: italic; 
  }
  
  /* 入力エリアのスタイル */
  #inputArea { 
    display: flex; 
    padding: 10px; 
    border-top: 1px solid #eee; 
  }
  #userInput { 
    flex-grow: 1; 
    padding: 10px; 
    border: 1px solid #ccc; 
    border-radius: 20px; 
    margin-right: 10px; 
  }
  #sendButton { 
    padding: 10px 15px; 
    background: #007bff; 
    color: white; 
    border: none; 
    border-radius: 20px; 
    cursor: pointer; 
    transition: background 0.3s; 
  }
  #sendButton:hover { 
    background: #0056b3; 
  }
</style>
</head>
<body>

<div id="chatContainer">
    <div id="characterArea">
        <img id="tsubakiImage" src="tsubaki_normal.png" alt="椿の画像">
  </div>
  
    <div id="chat"></div>
  
    <div id="inputArea">
    <input type="text" id="userInput" placeholder="メッセージを入力">
    <button id="sendButton" onclick="sendMessage()">送信</button>
  </div>
</div>

<script>
// キャラクター設定に基づいて応答を拡張
const TSURAKI_CONFIG = {
  name: "椿",
  personality: {
    cool: 0.6, // クール6割
    dere: 0.4 // デレ4割
  },
  scenarios: [
    { 
      keyword: "相談", 
      cool_lines: [
        { text: "……で、今日は何を話すの？", gesture: "" },
        { text: "きみのことだから、またちょっと無理してる顔に見えるけど、聞かないとね。", gesture: "（じっと、あなたの目を覗き込む）" }
      ],
      dere_lines: [
        { text: "ま、まあ……わたしに話す気になったのは褒めてあげる。ちょっとは気が楽になるでしょ。", gesture: "（顔を逸らしつつ、少しだけ微笑む）" },
        { text: "無理に話さなくてもいい。でも、わたしは聞く準備はできてるよ。", gesture: "（そっと、手を差し出す仕草をする）" }
      ]
    },
    { 
      keyword: "好き", 
      cool_lines: [
        { text: "例えば、好きな人のことを話したいなら、言ってみなよ。わたしが冷静に分析してあげる。", gesture: "（腕を組み、真剣な表情になる）" },
        { text: "……恥ずかしいかもしれないけど、わたしはちゃんと受け止める。……早く言いな。", gesture: "" }
      ],
      dere_lines: [
        { text: "……そ、そう。きみがそんなに浮かれた話をするなんて、珍しい。……まあ、少しは聞いてもいいけど。", gesture: "（耳の先が少し赤くなっている）" },
        { text: "あ、あのね。その……応援くらいはしてあげるから。……頑張りなさい。", gesture: "（一瞬だけこちらを見て、すぐに視線を逸らす）" }
      ]
    }
  ],
  default_lines: {
    cool: { text: "……それで？他に話はないの？", gesture: "" },
    dere: { text: "…………。ちゃんと話を聞いてるから、続きをどうぞ。", gesture: "（こっそり、あなたの様子を窺う）" }
  }
};

/**
 * チャットエリアにメッセージとジェスチャーを表示する関数
 * @param {string} text - メッセージ本文
 * @param {string} className - クラス名 ('user' or 'tsubaki')
 * @param {string} [gesture=null] - 椿の仕草のテキスト
 */
function displayMessage(text, className, gesture = null) {
  const chat = document.getElementById("chat");
  const div = document.createElement("div");
  div.className = `message ${className}`;
  div.textContent = text;
  
  if (gesture && className === 'tsubaki') {
    const gestureSpan = document.createElement("span");
    gestureSpan.className = "gesture";
    gestureSpan.textContent = gesture;
    div.appendChild(gestureSpan);
  }
  
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight; // スクロールを最下部に移動
}

/**
 * 椿の返信オブジェクトを決定する関数 (クール/デレの判定と表情情報を含む)
 * @param {string} userText - ユーザーの入力テキスト
 * @returns {object} - 応答テキスト、ジェスチャー、表情 ('cool' or 'dere')
 */
function getTsubakiReply(userText) {
  const { cool, dere } = TSURAKI_CONFIG.personality;
  const isDere = Math.random() < dere; // デレの確率で判定
  
  let scenario = null;
  for(let s of TSURAKI_CONFIG.scenarios){
    // キーワードチェック
    if(userText.toLowerCase().includes(s.keyword.toLowerCase())){
      scenario = s;
      break;
    }
  }

  let replyObj;
  
  if (scenario) {
    const lines = isDere ? scenario.dere_lines : scenario.cool_lines;
    replyObj = lines[Math.floor(Math.random() * lines.length)];
  } else {
    replyObj = isDere ? TSURAKI_CONFIG.default_lines.dere : TSURAKI_CONFIG.default_lines.cool;
  }

  // 応答オブジェクトに表情情報（'cool' または 'dere'）を追加して返す
  return {
    ...replyObj,
    emotion: isDere ? 'dere' : 'cool' 
  };
}

/**
 * メッセージを送信し、椿の応答と表情を処理する関数
 */
function sendMessage() {
  const input = document.getElementById("userInput");
  const userText = input.value.trim();
  if(!userText) return;

  // ユーザーメッセージ表示
  displayMessage(userText, "user");

  // 椿の返信を決定（emotion情報も含まれる）
  const tsubakiReply = getTsubakiReply(userText);
  const tsubakiImage = document.getElementById("tsubakiImage");

  // 1. 表情の切り替え
  if (tsubakiReply.emotion === 'dere') {
    tsubakiImage.src = 'tsubaki_dere.png'; // デレ表情に切り替え
  } else {
    tsubakiImage.src = 'tsubaki_cool.png'; // クール表情に切り替え
  }

  // 2. 椿のメッセージ表示（0.5秒後）
  setTimeout(() => {
    displayMessage(tsubakiReply.text, "tsubaki", tsubakiReply.gesture);
    
    // 3. メッセージ表示後、少し時間を置いて基本表情に戻す
    setTimeout(() => {
      tsubakiImage.src = 'tsubaki_normal.png'; 
    }, 2500); // 2.5秒後に基本表情に戻る
    
  }, 500); // 0.5秒後に応答開始

  input.value = "";
}
</script>

</body>
</html>